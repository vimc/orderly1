<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Deduplicate an orderly archive — orderly_deduplicate • orderly1</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deduplicate an orderly archive — orderly_deduplicate"><meta name="description" content='Deduplicate an orderly archive.  Deduplicating an orderly archive
will replace all files that have the same content with "hard
links".  This requires hard link support in the underlying
operating system, which is available on all unix-like systems
(e.g. MacOS and Linux) and on Windows since Vista.  However, on
windows systems this might require somewhat elevated privileges.
If you use this feature, it is very important that you
treat your orderly archive as read-only (though you should be
anyway) as changing one copy of a linked file changes all the
other instances of it - the files are literally the same file.'><meta property="og:description" content='Deduplicate an orderly archive.  Deduplicating an orderly archive
will replace all files that have the same content with "hard
links".  This requires hard link support in the underlying
operating system, which is available on all unix-like systems
(e.g. MacOS and Linux) and on Windows since Vista.  However, on
windows systems this might require somewhat elevated privileges.
If you use this feature, it is very important that you
treat your orderly archive as read-only (though you should be
anyway) as changing one copy of a linked file changes all the
other instances of it - the files are literally the same file.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly1</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bundles.html">orderly bundles</a></li>
    <li><a class="dropdown-item" href="../articles/changelog.html">orderly changelog</a></li>
    <li><a class="dropdown-item" href="../articles/orderly.html">orderly</a></li>
    <li><a class="dropdown-item" href="../articles/patterns.html">orderly patterns</a></li>
    <li><a class="dropdown-item" href="../articles/remote.html">orderly remotes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vimc/orderly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Deduplicate an orderly archive</h1>
      <small class="dont-index">Source: <a href="https://github.com/vimc/orderly/blob/main/R/deduplicate.R" class="external-link"><code>R/deduplicate.R</code></a></small>
      <div class="d-none name"><code>orderly_deduplicate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Deduplicate an orderly archive.  Deduplicating an orderly archive
will replace all files that have the same content with "hard
links".  This requires hard link support in the underlying
operating system, which is available on all unix-like systems
(e.g. MacOS and Linux) and on Windows since Vista.  However, on
windows systems this might require somewhat elevated privileges.
If you use this feature, it is <em>very important</em> that you
treat your orderly archive as read-only (though you should be
anyway) as changing one copy of a linked file changes all the
other instances of it - the files are literally the same file.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_deduplicate</span><span class="op">(</span>root <span class="op">=</span> <span class="cn">NULL</span>, locate <span class="op">=</span> <span class="cn">TRUE</span>, dry_run <span class="op">=</span> <span class="cn">TRUE</span>, quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>The path to an orderly root directory, or <code>NULL</code>
(the default) to search for one from the current working
directory if <code>locate</code> is <code>TRUE</code>.</p></dd>


<dt id="arg-locate">locate<a class="anchor" aria-label="anchor" href="#arg-locate"></a></dt>
<dd><p>Logical, indicating if the configuration should be
searched for.  If <code>TRUE</code> and <code>config</code> is not given,
then orderly looks in the working directory and up through its
parents until it finds an <code>orderly_config.yml</code> file.</p></dd>


<dt id="arg-dry-run">dry_run<a class="anchor" aria-label="anchor" href="#arg-dry-run"></a></dt>
<dd><p>Logical, indicating if the deduplication should be
planned but not run</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical, indicating if the status should not be printed</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly, information about the duplication status of the
archive before deduplication was run.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function will alter your orderly archive.  Ordinarily this is
not something that should be done, so we try to be careful.  In
order for this to work, it is <em>very important</em> to treat your
orderly archive as read-only generally.  If your canonical orderly
archive is behind OrderlyWeb this will almost certainly be the
case already.</p>
<p>With "hard linking", two files with the same content can be
updated so that both files point at the same physical bit of data.
This is great, as if the file is large, then only one copy needs
to be stored.  However, this means that if a change is made to one
copy of the file, it is immediately reflected in the other, but
there is nothing to indicate that the files are linked!</p>
<p>This approach is worth exploring if you have large files that are
outputs of one report and inputs to another, or large inputs
repeatedly used in different reports, or outputs that end up being
the same in multiple reports.  If you run the deduplication with
<code>dry_run = TRUE</code>, an indication of the savings will be
printed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="st">"demo"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">id1</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"minimal"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">name      </span> ]  minimal</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">id        </span> ]  20250919-200040-07497c35</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">start     </span> ]  2025-09-19 20:00:40.030813</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">data      </span> ]  source =&gt; dat: 20 x 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; png("mygraph.png")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; par(mar = c(15, 4, 0.5, 0.5))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; barplot(setNames(dat$number, dat$name), las = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; dev.off()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agg_record_1861921880 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     2 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">end       </span> ]  2025-09-19 20:00:40.049675</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">elapsed   </span> ]  Ran report in 0.01886201 secs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">artefact  </span> ]  mygraph.png: a7b94ccda59d3cdc6de2c3b088822f33</span>
<span class="r-in"><span><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"minimal"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">name      </span> ]  minimal</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">id        </span> ]  20250919-200040-133a3ba5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">start     </span> ]  2025-09-19 20:00:40.077423</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">data      </span> ]  source =&gt; dat: 20 x 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; png("mygraph.png")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; par(mar = c(15, 4, 0.5, 0.5))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; barplot(setNames(dat$number, dat$name), las = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; dev.off()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agg_record_1861921880 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     2 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">end       </span> ]  2025-09-19 20:00:40.095606</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">elapsed   </span> ]  Ran report in 0.01818347 secs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">artefact  </span> ]  mygraph.png: a7b94ccda59d3cdc6de2c3b088822f33</span>
<span class="r-in"><span><span class="fu"><a href="orderly_commit.html">orderly_commit</a></span><span class="op">(</span><span class="va">id1</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">commit    </span> ]  minimal/20250919-200040-07497c35</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">copy      </span> ]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">import    </span> ]  minimal:20250919-200040-07497c35</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">success   </span> ]  :)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/RtmpK9O2l4/file1d507d03fde9/archive/minimal/20250919-200040-07497c35"</span>
<span class="r-in"><span><span class="fu"><a href="orderly_commit.html">orderly_commit</a></span><span class="op">(</span><span class="va">id2</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">commit    </span> ]  minimal/20250919-200040-133a3ba5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">copy      </span> ]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">import    </span> ]  minimal:20250919-200040-133a3ba5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">success   </span> ]  :)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/RtmpK9O2l4/file1d507d03fde9/archive/minimal/20250919-200040-133a3ba5"</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">orderly1</span><span class="fu">::</span><span class="fu">orderly_deduplicate</span><span class="op">(</span><span class="va">path</span>, dry_run <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deduplication information for</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   /tmp/RtmpK9O2l4/file1d507d03fde9/archive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 6 tracked files</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 73.56 kB total size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 3 duplicate files</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 36.78 kB duplicated size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 0 deduplicated files</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 0 B deduplicated size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 0 untracked files</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - 0 B untracked size</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill, Martin Eden, Wes Hinsley, Emma Russell, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

