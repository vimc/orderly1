<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Rebuild the report database — orderly_rebuild • orderly1</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rebuild the report database — orderly_rebuild"><meta name="description" content="Rebuild the report database.  This is necessary when the orderly
database schema changes, and you will be prompted to run this
function after upgrading orderly in that case."><meta property="og:description" content="Rebuild the report database.  This is necessary when the orderly
database schema changes, and you will be prompted to run this
function after upgrading orderly in that case."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly1</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bundles.html">orderly bundles</a></li>
    <li><a class="dropdown-item" href="../articles/changelog.html">orderly changelog</a></li>
    <li><a class="dropdown-item" href="../articles/orderly.html">orderly</a></li>
    <li><a class="dropdown-item" href="../articles/patterns.html">orderly patterns</a></li>
    <li><a class="dropdown-item" href="../articles/remote.html">orderly remotes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vimc/orderly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Rebuild the report database</h1>
      <small class="dont-index">Source: <a href="https://github.com/vimc/orderly/blob/main/R/db.R" class="external-link"><code>R/db.R</code></a></small>
      <div class="d-none name"><code>orderly_rebuild.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Rebuild the report database.  This is necessary when the orderly
database schema changes, and you will be prompted to run this
function after upgrading orderly in that case.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_rebuild</span><span class="op">(</span></span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  locate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  if_schema_changed <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>The path to an orderly root directory, or <code>NULL</code>
(the default) to search for one from the current working
directory if <code>locate</code> is <code>TRUE</code>.</p></dd>


<dt id="arg-locate">locate<a class="anchor" aria-label="anchor" href="#arg-locate"></a></dt>
<dd><p>Logical, indicating if the configuration should be
searched for.  If <code>TRUE</code> and <code>config</code> is not given,
then orderly looks in the working directory and up through its
parents until it finds an <code>orderly_config.yml</code> file.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, indicating if information about the
rebuild should be printed as it runs</p></dd>


<dt id="arg-if-schema-changed">if_schema_changed<a class="anchor" aria-label="anchor" href="#arg-if-schema-changed"></a></dt>
<dd><p>Logical, indicating if the rebuild should
take place only if the schema has changed.  This is designed to
be safe to use in (say) deployment scripts because it will be
fast enough to call regularly.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>No return value, this function is called only for its side effects</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The report database (orderly's "destination" database) is
essentially an index over all the metadata associated with
reports.  It is used by orderly itself, and can be used by
applications that extend orderly (e.g.,
<a href="https://github.com/vimc/orderly-web" class="external-link">OrderlyWeb</a>.  All the
data in this database can be rebuilt from files stored with the
committed (archive) orderly reports, using the
<code>orderly_rebuild</code> function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="st">"minimal"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"example"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">name      </span> ]  example</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">id        </span> ]  20250919-200046-d119cba6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">start     </span> ]  2025-09-19 20:00:46.81924</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">data      </span> ]  source =&gt; dat: 20 x 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; png("mygraph.png")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; par(mar = c(15, 4, 0.5, 0.5))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; barplot(setNames(dat$number, dat$name), las = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; dev.off()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agg_record_653975181 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    2 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">end       </span> ]  2025-09-19 20:00:46.838936</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">elapsed   </span> ]  Ran report in 0.01969671 secs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">artefact  </span> ]  mygraph.png: a7b94ccda59d3cdc6de2c3b088822f33</span>
<span class="r-in"><span><span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_commit.html">orderly_commit</a></span><span class="op">(</span><span class="va">id</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">commit    </span> ]  example/20250919-200046-d119cba6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">copy      </span> ]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">import    </span> ]  example:20250919-200046-d119cba6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">success   </span> ]  :)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/RtmpK9O2l4/file1d5073a1193/archive/example/20250919-200046-d119cba6"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_db.html">orderly_db</a></span><span class="op">(</span><span class="st">"destination"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbReadTable.html" class="external-link">dbReadTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"report_version"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         id  report                       date displayname</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 20250919-200046-d119cba6 example 2025-09-19 20:00:46.854283        &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   description connection published    elapsed git_sha git_branch git_clean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        &lt;NA&gt;          0         0 0.01969671    &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="r-in"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The database can be removed and will be rebuilt if requested</span></span></span>
<span class="r-in"><span><span class="co"># (this is only a good idea if you do not extend the database with</span></span></span>
<span class="r-in"><span><span class="co"># your own fields - only the fields that orderly looks after can</span></span></span>
<span class="r-in"><span><span class="co"># be recovered!)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"orderly.sqlite"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu">orderly1</span><span class="fu">::</span><span class="fu">orderly_rebuild</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">backup    </span> ]  orderly.sqlite =&gt; backup/db/orderly.sqlite.20250919-200047</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">rebuild   </span> ]  db</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 20250919-200046-d119cba6 (example)</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"orderly.sqlite"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="orderly_db.html">orderly_db</a></span><span class="op">(</span><span class="st">"destination"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbReadTable.html" class="external-link">dbReadTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"report_version"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         id  report                       date displayname</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 20250919-200046-d119cba6 example 2025-09-19 20:00:46.854283        &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   description connection published    elapsed git_sha git_branch git_clean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        &lt;NA&gt;          0         0 0.01969671    &lt;NA&gt;       &lt;NA&gt;        NA</span>
<span class="r-in"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># It is safe to rebuild a database repeatedly, though this can be</span></span></span>
<span class="r-in"><span><span class="co"># slow with larger databases.</span></span></span>
<span class="r-in"><span><span class="fu">orderly1</span><span class="fu">::</span><span class="fu">orderly_rebuild</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">backup    </span> ]  orderly.sqlite =&gt; backup/db/orderly.sqlite.20250919-200047</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [ <span style="color: #5FAFD7; font-weight: bold;">rebuild   </span> ]  db</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 20250919-200046-d119cba6 (example)</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill, Martin Eden, Wes Hinsley, Emma Russell, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

