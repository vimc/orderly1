<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>orderly bundles • orderly1</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="orderly bundles">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly1</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bundles.html">orderly bundles</a></li>
    <li><a class="dropdown-item" href="../articles/changelog.html">orderly changelog</a></li>
    <li><a class="dropdown-item" href="../articles/orderly.html">orderly</a></li>
    <li><a class="dropdown-item" href="../articles/patterns.html">orderly patterns</a></li>
    <li><a class="dropdown-item" href="../articles/remote.html">orderly remotes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vimc/orderly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>orderly bundles</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vimc/orderly/blob/main/vignettes/bundles.Rmd" class="external-link"><code>vignettes/bundles.Rmd</code></a></small>
      <div class="d-none name"><code>bundles.Rmd</code></div>
    </div>

    
    
<p>If you have an orderly report that takes a very long time, or needs
to run in parallel, you might need to send it to run on another
computer. There are a number of ways of achieving this - the simplest
might be to clone the source tree to another computer, run the reports
there and use one of <a href="patterns.html">a number of possible
approaches to sync the outputs between computers</a>. However, there
will be cases where that is not ideal, and you want to move around much
less data around.</p>
<p>This vignette describes a way of parcelling together all dependencies
of an orderly report into a zip file (a “<strong>bundle</strong>”) that
can be distributed to another machine (e.g., via scp, rsync or a shared
file system), run there, and returned. It does not provide a transparent
approach to using high-performance computing with orderly as we feel
that the specific circumstances are too varied to support this
directly.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In order to use orderly bundles we make some assumptions and
conventions.</p>
<p>First, we assume that you will be running your exported report on
another machine (otherwise you would have access to the orderly tree)
and that your report takes really quite a long time.</p>
<p>Second, we assume you have your own way of getting the bundled
reports <em>to</em> your other machine and the completed bundles back
again — we expect that the details here will be specific to your needs
and situation and that the overhead of doing this will be trivial
compared with the cost of running the report.</p>
<p>Third, we assume that you will deal with all issues around queuing,
locking and fault tolerance. From orderly’s point of view work will be
exported from orderly and at this point you’re in control - we expect it
to come back computed at some point, though we do not enforce that.</p>
<p>Fourth, that the machine running the report can be trusted to
<em>actually run the report</em> - if you have set up an orderly server
that is safe from interactively run reports, don’t allow importing from
anyone’s laptops if you want to preserve this.</p>
<p>Fifth, that you trust your remote machine with your data, and that
the remote machine trusts your orderly archive enough to run arbitrary
code on it.</p>
</div>
<div class="section level2">
<h2 id="the-process">The process<a class="anchor" aria-label="anchor" href="#the-process"></a>
</h2>
<p>We will use the orderly demo example, and pack up the
<code>use_dependency</code> report.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="st">"demo"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>use_dependency</code> report has a dependency, which we
run</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"other"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nmin <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                           echo <span class="op">=</span> <span class="cn">FALSE</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">name      </span> ]  other</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">id        </span> ]  20250919-200053-b89968e5</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">sources   </span> ]  functions.R</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">parameter </span> ]  nmin: 0</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">start     </span> ]  2025-09-19 20:00:53.740013</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">data      </span> ]  source =&gt; extract: 20 x 2</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">parameter </span> ]  nmin: 0</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">end       </span> ]  2025-09-19 20:00:53.794675</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">elapsed   </span> ]  Ran report in 0.05466223 secs</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">artefact  </span> ]  summary.csv: 3fac8347e152c84c96e6676413c718b7</span></span>
<span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">...       </span> ]  graph.png: 67b3e662440b3978ee78b9d4cc159884</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_commit.html">orderly_commit</a></span><span class="op">(</span><span class="va">id</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">commit    </span> ]  other/20250919-200053-b89968e5</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">copy      </span> ]</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">import    </span> ]  other:20250919-200053-b89968e5</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">success   </span> ]  :)</span></span></code></pre>
<pre><code><span><span class="co">## [1] "/tmp/RtmpBcxZt2/file20785e0eb6ed/archive/other/20250919-200053-b89968e5"</span></span></code></pre>
<p>We need a place that we’ll put the bundles:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_bundles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can pack up <code>use_dependency</code> to run</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bundle</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_bundle_pack.html">orderly_bundle_pack</a></span><span class="op">(</span><span class="va">path_bundles</span>, <span class="st">"use_dependency"</span>,</span>
<span>                                       root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">name      </span> ]  use_dependency</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">id        </span> ]  20250919-200054-28a1021a</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">depends   </span> ]  other@20250919-200053-b89968e5:summary.csv -&gt; incoming.csv</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">start     </span> ]  2025-09-19 20:00:54.161994</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">bundle pack</span> ]  20250919-200054-28a1021a</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bundle</span></span></code></pre></div>
<pre><code><span><span class="co">## $id</span></span>
<span><span class="co">## [1] "20250919-200054-28a1021a"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $path</span></span>
<span><span class="co">## [1] "/tmp/RtmpBcxZt2/file20785da8ca4a/20250919-200054-28a1021a.zip"</span></span></code></pre>
<p><code>orderly_bundle_pack</code> has created a zip file. The format
of this file is internal to orderly (it will likely change and will at
some point become resistant to tampering), but contains:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">zip</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/zip/reference/zip_list.html" class="external-link">zip_list</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">$</span><span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A data frame: 10 × 8</span></span></span>
<span><span class="co">##    filename    compressed_size uncompressed_size timestamp           permissions</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;octmode&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 20250919-2…               0                 0 2025-09-19 <span style="color: #949494;">20:00:54</span> 755        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 20250919-2…               0                 0 2025-09-19 <span style="color: #949494;">20:00:54</span> 755        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 20250919-2…            <span style="text-decoration: underline;">1</span>466              <span style="text-decoration: underline;">1</span>461 2025-09-19 <span style="color: #949494;">20:00:54</span> 644        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 20250919-2…            <span style="text-decoration: underline;">3</span>424              <span style="text-decoration: underline;">3</span>419 2025-09-19 <span style="color: #949494;">20:00:54</span> 644        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 20250919-2…             287               282 2025-09-19 <span style="color: #949494;">20:00:54</span> 644        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 20250919-2…           <span style="text-decoration: underline;">27</span>840             <span style="text-decoration: underline;">27</span>835 2025-09-19 <span style="color: #949494;">20:00:54</span> 644        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 20250919-2…               0                 0 2025-09-19 <span style="color: #949494;">20:00:54</span> 755        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 20250919-2…             542               888 2025-09-19 <span style="color: #949494;">20:00:54</span> 644        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 20250919-2…             214               358 2025-09-19 <span style="color: #949494;">20:00:54</span> 644        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 20250919-2…             176               221 2025-09-19 <span style="color: #949494;">20:00:54</span> 644        </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: crc32 &lt;hexmode&gt;, offset &lt;dbl&gt;, type &lt;chr&gt;</span></span></span></code></pre>
<p>The subdirectory <code>pack</code> contains the report working
directory, all code and dependencies, etc, while <code>meta</code>
contains additional information required to run the report. In
particular the <code>incoming.csv</code> file in the <code>pack</code>
directory contains the dependency imported from <code>other</code>.</p>
<p>Then copy this zip file somewhere else to run it (details vary based
on your system, and moving the file is not <em>necessary</em> to run it,
though it will be the most likely situation).</p>
<p>Once the files have been moved we can run it with:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">workdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_bundle_pack.html">orderly_bundle_run</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">$</span><span class="va">path</span>, <span class="va">workdir</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">start     </span> ]  2025-09-19 20:00:54.452752</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## &gt; d &lt;- read.csv("incoming.csv", stringsAsFactors = FALSE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## &gt; png("graph.png")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## &gt; par(mar = c(15, 4, 0.5, 0.5))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## &gt; barplot(setNames(d$number, d$name), las = 2)</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## &gt; dev.off()</span></span>
<span><span class="co">## agg_png </span></span>
<span><span class="co">##       2 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## &gt; info &lt;- orderly1::orderly_run_info()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## &gt; saveRDS(info, "info.rds")</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">end       </span> ]  2025-09-19 20:00:54.468376</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">elapsed   </span> ]  Ran report in 0.01562381 secs</span></span></code></pre>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">artefact  </span> ]  graph.png: 67b3e662440b3978ee78b9d4cc159884</span></span>
<span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">...       </span> ]  info.rds: 83b69f579030713c68f61c00ae7f8b94</span></span></code></pre>
<p>With the <code>workdir</code> being a directory that you want the
report to be run in. This can be the same as the path the incoming zip
file is found, if you want, but this will make it harder to know what
has been run already or not.</p>
<p>This creates <em>another</em> zip file, but this time contains the
results of running the report.</p>
<p>The result can be imported into order by using
<code><a href="../reference/orderly_bundle_pack.html">orderly1::orderly_bundle_import</a></code> with the path to the zip
file:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_bundle_pack.html">orderly_bundle_import</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">path</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [ <span style="color: #5FAFD7; font-weight: bold;">import    </span> ]  use_dependency:20250919-200054-28a1021a</span></span></code></pre>
<p>The copy of <code>use_dependency</code> is now in the archive and can
be used like any other orderly report</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_list_drafts.html">orderly_list_archive</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             name                       id</span></span>
<span><span class="co">## 1          other 20250919-200053-b89968e5</span></span>
<span><span class="co">## 2 use_dependency 20250919-200054-28a1021a</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly1</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_graph.html">orderly_graph</a></span><span class="op">(</span><span class="st">"other"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #0000BB;">other [20250919-200053-b89968e5]</span></span></span>
<span><span class="co">## <span style="color: #0000BB;">└──use_dependency [20250919-200054-28a1021a]</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<ul>
<li><p>We do not yet verify that the incoming bundle comes from a
trusted source, nor that the completed bundle was run on a trusted
system, nor that the bundle pack was not modified en route. We will add
a signing and verifying step in future that will address these
issues.</p></li>
<li><p>We do not support encryption of the bundle, but may do so in a
future version.</p></li>
<li><p>Secrets will be copied in clear text if included.</p></li>
<li><p>We do not check that the package versions on the remote machine
are suitable, though metadata is included to support this in
future.</p></li>
<li><p>We do not support reading from databases using the
<code>connection:</code> field while the report is running (reading data
<em>before</em> is fine). In future we may relax this so that the remote
report interacts with the database. Practically this means that bundled
reports cannot use the <code>connection:</code> field, and all data will
be packaged into the bundle, and so may be large.</p></li>
<li><p>As discussed above in <a href="#overview">the overview
section</a>, orderly does not deal with the movement of bundles between
machines, nor queuing of these bundles.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill, Martin Eden, Wes Hinsley, Emma Russell, James Thompson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
